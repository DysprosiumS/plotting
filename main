import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from seaborn import kdeplot

df = pd.read_excel('ссылка на файл', sheet_name=1)

# Построение распределения 
plt.figure(figsize=(12, 8))

# Расчет статистики
data_column = df[df.columns[0]]
count_val = data_column.count()
mean_val = data_column.mean()
std_val = data_column.std()
sem_val = data_column.sem()
median_val = data_column.median()
min_val = data_column.min()
max_val = data_column.max()

# Гистограмма с KDE
plt.subplot(2, 2, 1)
sns.histplot(data=df, bins=15, legend=True)
sns.kdeplot(data=df, x=df.columns[0], fill=True, alpha=0.1, color='green',  linewidth=2)

# Текст с нужными статистиками
stats_text = f'''Статистики:
Среднее: {mean_val:.4f}
Медиана: {median_val:.4f}
Ст. откл.: {std_val:.4f}'''

plt.text(0.02, 0.97, stats_text,
         transform=plt.gca().transAxes,
         fontsize=8,
         verticalalignment='top',
         bbox=dict(boxstyle="round,pad=0.5", facecolor="white", alpha=0.9))

plt.title(f'Распределение (Гистограмма + KDE)')
plt.xlabel('Параметр')
plt.ylabel('Частота')
plt.grid(True, alpha=0.3) #сетка
plt.tight_layout() #подгоняет кде под размер гистограммы

# Функция для сохранения в файл
def save_statistics_to_txt(filename, data, column_name="Данные"):
    """
    Записывает статистику в txt файл
    """
    with open(filename, 'w', encoding='utf-8') as file:
        file.write(f"Статистика ")
        file.write("=" * 40 + "\n")
        file.write(f"Количество значений: {data.count()}\n")
        file.write(f"Среднее значение: {data.mean():.6f}\n")
        file.write(f"Медиана: {data.median():.6f}\n")
        file.write(f"Стандартное отклонение: {data.std():.6f}\n")
        file.write(f"Стандартное отклонение для среднего: {data.sem():.6f}\n")
        file.write(f"Минимальное значение: {data.min():.6f}\n")
        file.write(f"Максимальное значение: {data.max():.6f}\n")
        file.write(f"Дисперсия: {data.var():.6f}\n")
        file.write(f"Первый квартиль (Q1): {data.quantile(0.25):.6f}\n")
        file.write(f"Третий квартиль (Q3): {data.quantile(0.75):.6f}\n")
        file.write(f"Межквартильный размах (IQR): {data.quantile(0.75) - data.quantile(0.25):.6f}\n")

# Сохранение статистики
column_stat = df.columns[0]
output_filename = f'ссылка на файл/statistics.txt'

save_statistics_to_txt(output_filename, data_column, column_stat)
print(f"Статистика сохранена в файл: {output_filename}")
print(df.describe())

plt.show()
